package ozone.owf.grails.test.integration

import ozone.owf.grails.domain.WidgetDefinition
import ozone.owf.grails.domain.Preference
import ozone.owf.grails.domain.Person
import ozone.owf.grails.domain.PersonWidgetDefinition

class AdministrationServiceTests extends OWFGroovyTestCase {

    def administrationService

	protected void setUp() {
		super.setUp() 
		loginAsAdmin()
	}
	
	/**
	 * OWF-1087
	 * 
	 * There was a 255 character limit on the field value. Turned this into a text field (clob in oracle) 
	 */
	void testAddBigJson(){
		Map pref = [
				checkedTargets:	[testAdmin1ID,testUser1ID,testUser2ID],
				isExtAjaxFormat: true,
				namespace: "com.company.widget",
				path: "name",
				value: '{ "a" : "1234567890", "b" : "1234567890", "c" : "1234567890", "d" : "1234567890", "e" : "1234567890", "f" : "1234567890", "g" : "1234567890", "h" : "1234567890", "i" : "1234567890", "j" : "1234567890", "k" : "1234567890", "l" : "1234567890", "m" : "1234567890", "n" : "1234567890", "o" : "1234567890", "p" : "1234567890", "q" : "1234567890", "r" : "1234567890", "s" : "1234567890", "t" : "1234567890", "u" : "1234567890", "v" : "1234567890", "w" : "1234567890", "x" : "1234567890", "y" : "1234567890", "z" : "1234567890" }'
		]
		administrationService.clonePreference(pref) 
		assertEquals Preference.findByPath("name").namespace, 'com.company.widget'
	}
	
	/**
	 * OWF-1087
	 * 
	 * There was a 255 character limit on the field value. Turned this into a text field (clob in oracle) 
	 */
	void testEditPreferenceWithLargeValue(){
		Map pref = [
		            checkedTargets:	[Person.findByUsername("testAdmin1").id,Person.findByUsername("testUser1").id,Person.findByUsername("testUser2").id],
					isExtAjaxFormat: true,
					namespace: "com.company.widget",
					path: "name",
					value: 'test'
		]
		administrationService.clonePreference(pref) 
		assertEquals Preference.findByPath("name").namespace, 'com.company.widget'
		
		Map updatedPref = [
				userid:	testAdmin1ID,
				isExtAjaxFormat: true,
				namespace: "com.company.widget2",
				originalNamespace: "com.company.widget",
				path: "name2",
				originalPath: "name",
				value: '12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890'
		]
		administrationService.updatePreference(updatedPref)
		assertEquals Preference.findByPath("name2").namespace, 'com.company.widget2'
	}

}